<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Serviços — Mineiro Barbershop</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    /* Ripple seguro e discreto */
    .r{position:absolute;pointer-events:none;width:8px;height:8px;border-radius:999px;transform:translate(-50%,-50%);background:currentColor;opacity:.25;animation:ripple .6s ease-out forwards}
    @keyframes ripple{from{width:0;height:0;opacity:.35}to{width:280px;height:280px;opacity:0}}
    .chip{position:relative}

    /* --- FIX: lista cola no topo, nunca no rodapé --- */
    .list{
      /* força layout previsível e colado nos filtros */
      display:grid !important;
      grid-template-columns: 1fr;
      gap: 12px;
      align-content:start !important;    /* gruda no topo mesmo com altura livre */
      justify-content:stretch !important;
      min-height:auto !important;        /* neutraliza heights herdados */
      margin-top:0 !important;           /* neutraliza margin-top:auto */
      align-self:auto !important;        /* caso o parent seja grid/flex */
    }
    /* se quiser colunas em telas maiores, descomente:
    @media (min-width: 720px){ .list{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (min-width: 1080px){ .list{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
    */

    /* cartões sem “empurrão” vertical extra */
    .list .item{ margin-top:0 !important; }

    /* Se seu container pai for flex em coluna com justify-content:end,
       esses dois garantem que a lista não desça: */
    .app{ justify-content:flex-start !important; }
    .app > .list{ order:initial; }

    /* opcional: âncora de rolagem quando usamos scrollIntoView */
    .list{ scroll-margin-top:84px; } /* ajuste conforme altura da topbar */
  </style>
</head>
<body>

<main class="app services-page" aria-labelledby="page-title">

  <!-- Topbar -->
  <header class="topbar">
    <a class="back ripple" href="index.html" aria-label="Voltar">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </a>
    <h1 id="page-title">Serviços</h1>
  </header>

  <!-- Filtros -->
  <nav class="filters" aria-label="Filtrar categorias">
    <button class="chip ripple is-on" type="button" data-filter="all" aria-pressed="true">Todos</button>
    <button class="chip ripple" type="button" data-filter="cabelo" aria-pressed="false">Cabelo</button>
    <button class="chip ripple" type="button" data-filter="barba" aria-pressed="false">Barba</button>
    <button class="chip ripple" type="button" data-filter="coloracao" aria-pressed="false">Coloração</button>
    <button class="chip ripple" type="button" data-filter="tratamento" aria-pressed="false">Tratamento</button>
    <button class="chip ripple" type="button" data-filter="sobrancelha" aria-pressed="false">Sobrancelha</button>
  </nav>

  <!-- Lista -->
  <section class="list" aria-label="Lista de serviços">
    <!-- Corte -->
    <article class="item reveal" data-id="corte" data-price="50" data-min="30" data-tags="cabelo">
      <figure class="thumb"><img src="img/svc-corte.jpg" alt="Corte masculino"></figure>
      <div class="meta">
        <h3 class="name">Corte</h3>
        <span class="price-badge" data-p></span>
        <p class="desc">Máquina e tesoura — aprox. 30min</p>
      </div>
      <button class="choose ripple" type="button" aria-pressed="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>

    <!-- Barba -->
    <article class="item reveal" data-id="barba" data-price="40" data-min="25" data-tags="barba">
      <figure class="thumb"><img src="img/svc-barba.jpg" alt="Barba"></figure>
      <div class="meta">
        <h3 class="name">Barba</h3>
        <span class="price-badge" data-p></span>
        <p class="desc">Navalha e toalha quente — 25min</p>
      </div>
      <button class="choose ripple" type="button" aria-pressed="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>

    <!-- Coloração -->
    <article class="item reveal" data-id="coloracao" data-price="90" data-min="45" data-tags="coloracao cabelo">
      <figure class="thumb"><img src="img/svc-color.jpg" alt="Coloração"></figure>
      <div class="meta">
        <h3 class="name">Coloração</h3>
        <span class="price-badge" data-p></span>
        <p class="desc">Cobertura ou tonalizante — 45min</p>
      </div>
      <button class="choose ripple" type="button" aria-pressed="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>

    <!-- Tratamento -->
    <article class="item reveal" data-id="tratamento" data-price="70" data-min="35" data-tags="tratamento cabelo">
      <figure class="thumb"><img src="img/svc-trat.jpg" alt="Tratamento capilar"></figure>
      <div class="meta">
        <h3 class="name">Tratamento</h3>
        <span class="price-badge" data-p></span>
        <p class="desc">Hidratação/antiqueda — 35min</p>
      </div>
      <button class="choose ripple" type="button" aria-pressed="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>

    <!-- Sobrancelha -->
    <article class="item reveal" data-id="sobrancelha" data-price="30" data-min="15" data-tags="sobrancelha">
      <figure class="thumb"><img src="img/svc-sobr.jpg" alt="Sobrancelha"></figure>
      <div class="meta">
        <h3 class="name">Sobrancelha</h3>
        <span class="price-badge" data-p></span>
        <p class="desc">Design masculino — 15min</p>
      </div>
      <button class="choose ripple" type="button" aria-pressed="false">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>
  </section>

  <!-- CTA inferior -->
  <div class="cta-bar">
    <button class="btn" data-del disabled>Deletar</button>
    <button class="btn btn-primary" data-next disabled>Avançar</button>
  </div>

  <p class="hide-text" aria-live="polite" id="sr-status"></p>
</main>

<!-- ===== JS ===== -->
<script>
/* Reveal on scroll */
(() => {
  const obs = new IntersectionObserver((ents)=>{
    ents.forEach(e=>{
      if(e.isIntersecting){
        e.target.classList.add('is-in');
        obs.unobserve(e.target);
      }
    });
  }, {threshold:.12, rootMargin:"0px 0px -40px 0px"});
  document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));
})();
</script>

<script>
/* Ripple seguro */
(() => {
  const add = (btn, e) => {
    const r = document.createElement('span');
    r.className = 'r';
    const b = btn.getBoundingClientRect();
    r.style.left = (e.clientX - b.left) + 'px';
    r.style.top  = (e.clientY - b.top)  + 'px';
    btn.appendChild(r);
    r.addEventListener('animationend', () => r.remove(), { once: true });
  };
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.ripple');
    if (!btn) return;
    add(btn, e);
  }, { passive: true });
})();
</script>

<script>
/* Preenche badges de preço */
(() => {
  const money = v => Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  document.querySelectorAll('.item').forEach(card=>{
    const price = card.dataset.price;
    const badge = card.querySelector('[data-p]');
    if(badge){ badge.textContent = money(price); }
  });
})();
</script>

<script>
/* Filtro por chips — força display e mantém conteúdo no topo */
(() => {
  const bar   = document.querySelector('.filters');
  const list  = document.querySelector('.list');
  const items = Array.from(document.querySelectorAll('.item'));

  function apply(val){
    // chips
    bar.querySelectorAll('.chip').forEach(c=>{
      const on = c.dataset.filter === val;
      c.classList.toggle('is-on', on);
      c.setAttribute('aria-pressed', on);
    });

    // itens
    items.forEach(it=>{
      const tags = (it.dataset.tags || '').trim().split(/\s+/);
      const show = (val === 'all') || tags.includes(val);
      it.style.display = show ? '' : 'none';
      it.setAttribute('aria-hidden', show ? 'false' : 'true');
    });

    // garante que a lista fique visível logo abaixo dos filtros
    list.scrollIntoView({ behavior: 'instant', block: 'start' });
  }

  // Delegação de clique
  bar.addEventListener('click', (e) => {
    const chip = e.target.closest('.chip');
    if (!chip) return;
    apply(chip.dataset.filter);
  });

  // estado inicial
  const initial = bar.querySelector('.chip.is-on')?.dataset.filter || 'all';
  apply(initial);
})();
</script>

<script>
/* Seleção com LIFO + persistência e navegação */
(() => {
  const cards = [...document.querySelectorAll('.list .item')].map(el => ({
    id: el.dataset.id,
    price: Number(el.dataset.price || 0),
    min: Number(el.dataset.min || 0),
    el,
    btn: el.querySelector('.choose')
  }));
  const btnDel  = document.querySelector('[data-del]');
  const btnNext = document.querySelector('[data-next]');
  const moneyBR = v => 'R$ ' + v.toFixed(2).replace('.', ',');

  const stack = [];

  cards.forEach(({ id, price, min, btn }) => {
    btn.addEventListener('click', () => {
      const on = btn.classList.toggle('is-on');
      const ix = stack.findIndex(s => s.id === id);
      if (on && ix === -1) stack.push({ id, price, min });
      if (!on && ix !== -1) stack.splice(ix, 1);
      updateFooter();
    });
  });

  btnDel.addEventListener('click', () => {
    if (!stack.length) return;
    const last = stack.pop();
    const card = cards.find(c => c.id === last.id);
    if (card) card.btn.classList.remove('is-on');
    updateFooter();
  });

  function updateFooter(){
    const count = stack.length;
    const total = stack.reduce((a,s)=>a+s.price,0);
    btnDel.disabled  = count === 0;
    btnNext.disabled = count === 0;
    btnNext.textContent = count ? `Avançar (${count}) — ${moneyBR(total)}` : 'Avançar';
  }
  updateFooter();

  btnNext.addEventListener('click', () => {
    const ids     = stack.map(s => s.id);
    const total   = stack.reduce((a,s)=>a+s.price, 0);
    const minutes = stack.reduce((a,s)=>a+s.min,   0);

    localStorage.setItem('svc.selected', JSON.stringify(ids));
    localStorage.setItem('svc.total', String(total));
    localStorage.setItem('svc.minutes', String(minutes));
    localStorage.setItem('svc.count', String(ids.length));

    window.location.href = 'professionals.html';
  });

  // tratamento de falha de imagem
  document.querySelectorAll('.thumb img').forEach(img=>{
    img.addEventListener('error', ()=>{
      const box = img.parentElement;
      img.remove();
      box.classList.add('no-img');
    });
  });
})();
</script>
</body>
</html>

