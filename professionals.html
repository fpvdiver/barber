<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profissionais — Mineiro Barbershop</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<main class="app professionals-page" aria-labelledby="title">
  <!-- Topbar -->
  <header class="topbar">
    <a class="back ripple" href="services.html" aria-label="Voltar">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </a>
    <h1 id="title">Profissionais</h1>
  </header>

  <!-- Lista de profissionais (grid igual ao Services) -->
  <section class="list" id="proList" aria-label="Lista de profissionais">
    <!-- Fernando -->
    <article class="item reveal" data-id="fernando" data-skills="corte barba">
      <figure class="thumb"><img src="img/pro-fernando.jpg" alt="Fernando"></figure>
      <div class="meta">
        <h3 class="name">Fernando <span class="rate">★ 4,8</span></h3>
        <p class="desc">Barbeiro • Corte e Barba</p>
      </div>
      <button class="choose ripple" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>

    <!-- Jonnier -->
    <article class="item reveal" data-id="jonnier" data-skills="corte coloracao">
      <figure class="thumb"><img src="img/pro-jonnier.jpg" alt="Jonnier"></figure>
      <div class="meta">
        <h3 class="name">Jonnier <span class="rate">★ 4,7</span></h3>
        <p class="desc">Stylist • Corte e Coloração</p>
      </div>
      <button class="choose ripple" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>

    <!-- Marcos -->
    <article class="item reveal" data-id="marcos" data-skills="corte">
      <figure class="thumb"><img src="img/pro-marcos.jpg" alt="Marcos"></figure>
      <div class="meta">
        <h3 class="name">Marcos <span class="rate">★ 4,6</span></h3>
        <p class="desc">Barbeiro • Corte masculino</p>
      </div>
      <button class="choose ripple" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>

    <!-- Aline -->
    <article class="item reveal" data-id="aline" data-skills="coloracao tratamento sobrancelha">
      <figure class="thumb"><img src="img/pro-aline.jpg" alt="Aline"></figure>
      <div class="meta">
        <h3 class="name">Aline <span class="rate">★ 4,9</span></h3>
        <p class="desc">Colorista • Coloração, Tratamentos</p>
      </div>
      <button class="choose ripple" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span>Escolher</span>
      </button>
    </article>
  </section>

  <!-- Rodapé com resumo e ações -->
  <div class="pro-bar">
    <div class="summary" id="sum">R$ 0,00 • 0 serviço • 0 min</div>
    <button class="btn ripple" id="btnBack" type="button">Voltar</button>
    <button class="btn btn-primary ripple" id="btnNext" type="button" disabled>Continuar</button>
  </div>
</main>

<!-- ===== JS ===== -->
<script>
/* Helpers base */
const moneyBR = v => 'R$ ' + Number(v||0).toFixed(2).replace('.', ',');
const getStore = k => localStorage.getItem(k) ?? sessionStorage.getItem(k);

/* Estado vindo de Serviços */
const REQUIRED = new Set(JSON.parse(getStore('svc.selected') || '[]')); // ex.: ["corte","coloracao"]
const total   = Number(getStore('svc.total')   || 0);
const minutes = Number(getStore('svc.minutes') || 0);
const count   = Number(getStore('svc.count')   || 0);
document.getElementById('sum').textContent = `${moneyBR(total)} • ${count} serviço${count>1?'s':''} • ${minutes} min`;

/* Reveal suave */
(() => {
  const obs = new IntersectionObserver((ents)=>{
    ents.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('is-in'); obs.unobserve(e.target); } });
  }, {threshold:.12, rootMargin:"0px 0px -40px 0px"});
  document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));
})();

/* Ripple */
(() => {
  document.addEventListener('click', (e) => {
    const el = e.target.closest('.ripple'); if(!el) return;
    const r  = document.createElement('span'); r.className = 'r';
    const b  = el.getBoundingClientRect();
    r.style.left = (e.clientX - b.left) + 'px';
    r.style.top  = (e.clientY - b.top)  + 'px';
    el.appendChild(r);
    r.addEventListener('animationend', () => r.remove(), { once:true });
  }, { passive:true });
})();

/* Profissionais: ativação/desativação + seleção */
(() => {
  const cards = [...document.querySelectorAll('.professionals-page .item')].map(el => ({
    id: el.dataset.id,
    skills: (el.dataset.skills||'').split(/\s+/).filter(Boolean),
    el,
    btn: el.querySelector('.choose')
  }));

  // Desativar quem NÃO faz nenhum dos serviços requeridos
  const hasRequirements = REQUIRED.size > 0;
  if (hasRequirements) {
    cards.forEach(c => {
      const ok = c.skills.some(s => REQUIRED.has(s));
      if (!ok) {
        c.el.classList.add('is-disabled');
        c.btn.setAttribute('disabled','');
      }
    });
  }

  // Seleção (multi) + CTA
  const selected = new Set();
  const btnNext  = document.getElementById('btnNext');
  const btnBack  = document.getElementById('btnBack');

  function syncUI(){
    cards.forEach(c => c.btn.classList.toggle('is-on', selected.has(c.id)));
    btnNext.disabled = selected.size === 0;
    btnNext.textContent = selected.size ? `Continuar (${selected.size})` : 'Continuar';
  }

  cards.forEach(c => {
    c.btn.addEventListener('click', () => {
      if (c.el.classList.contains('is-disabled')) return;
      selected.has(c.id) ? selected.delete(c.id) : selected.add(c.id);
      syncUI();
    });
  });

  function unionSkills(ids){
    const set = new Set();
    ids.forEach(id => {
      const c = cards.find(x => x.id === id);
      (c?.skills || []).forEach(s => set.add(s));
    });
    return set;
  }
  const label = s => ({corte:'corte', barba:'barba', coloracao:'coloração', tratamento:'tratamento', sobrancelha:'sobrancelha'}[s] || s);

  btnNext.addEventListener('click', () => {
    if (selected.size === 0) return;

    // Validação: seleção cobre todos os serviços?
    const covered = unionSkills([...selected]);
    const missing = [...REQUIRED].filter(s => !covered.has(s));
    if (missing.length){
      alert('Você selecionou profissionais que não cobrem: ' + missing.map(label).join(', ') + '.');
      return;
    }

    localStorage.setItem('selectedPros', JSON.stringify([...selected]));
    localStorage.setItem('proMode', 'per'); // multi por serviço
    window.location.href = 'agendamentos.html';
  });

  btnBack.addEventListener('click', () => window.location.href = 'services.html');

  syncUI();

  // Fallback de imagem
  document.querySelectorAll('.thumb img').forEach(img=>{
    img.addEventListener('error', ()=>{
      const box = img.parentElement; img.remove(); box.classList.add('no-img');
    });
  });
})();
</script>
</body>
</html>

