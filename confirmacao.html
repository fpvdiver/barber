<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Revisar & Confirmar — Mineiro Barbershop</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">

  <style>
    /* ===== específicas da tela ===== */
    .wrap{ padding:14px; padding-bottom:96px; max-width:428px; margin:0 auto }
    .panel{
      background:var(--panel); border:1px solid var(--line);
      border-radius:14px; padding:14px; margin-bottom:14px;
    }
    .panel h2{ margin:0 0 10px; font:600 14px/1 Poppins; letter-spacing:.02em }

    /* cartão do local */
    .shop{
      display:grid; grid-template-columns:84px 1fr; gap:12px;
      background:var(--panel-2); border:1px solid var(--line); border-radius:12px; padding:10px;
    }
    .shop .th{ width:84px; height:84px; border-radius:10px; overflow:hidden; border:1px solid var(--line); background:#0c0d0f }
    .shop .th img{ width:100%; height:100%; object-fit:cover; display:block }
    .shop h3{ margin:0 0 6px; font:600 15px/1 Poppins }
    .shop .sub{ color:var(--muted); font-size:12px; }
    .statrow{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:8px }
    .stat{ text-align:center; background:#141518; border:1px solid var(--line); border-radius:10px; padding:8px 6px }
    .stat strong{ display:block; color:#fff }
    .stat span{ color:var(--muted); font-size:11px }

    /* schedule list */
    .kv{ display:grid; grid-template-columns:110px 1fr; gap:8px; padding:8px 0; border-top:1px dashed rgba(255,255,255,.08) }
    .kv:first-of-type{ border-top:0; padding-top:0 }
    .kv .k{ color:#cfd0d4; font-size:12px }
    .services-list{ display:flex; flex-wrap:wrap; gap:6px }
    .tag{
      font:600 11px/1 Poppins; padding:8px 10px; border-radius:999px;
      border:1px solid var(--line); background:#111214; color:#e6e7ea;
    }

    /* cobrança */
    .bill-row{ display:flex; justify-content:space-between; align-items:center; padding:8px 0; }
    .bill-row.total{ border-top:1px solid var(--line); margin-top:6px; padding-top:10px; }
    .muted{ color:var(--muted) }

    /* barra inferior */
    .confirm-bar{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:10px; width:min(428px,94vw);
      display:grid; grid-template-columns:auto 1fr; gap:10px;
      background:var(--panel-2); border:1px solid var(--line); border-radius:14px; padding:10px 12px;
      box-shadow:var(--shadow);
    }
    .btn-ghost{
      height:46px; border-radius:12px; border:1px solid var(--line);
      background:transparent; color:#eaecef; font:600 14px/1 Poppins; padding:0 14px; cursor:pointer;
    }
    .btn-primary{ min-width:210px }
  </style>
</head>
<body>

<main class="app" aria-labelledby="page-title">
  <!-- Topbar -->
  <header class="topbar">
    <a class="back ripple" href="agendamentos.html" aria-label="Voltar">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </a>
    <h1 id="page-title">Revisar & Confirmar</h1>
  </header>

  <div class="wrap">

    <!-- Local / barbearia -->
    <section class="panel">
      <div class="shop">
        <div class="th"><img src="img/logobarber.png" alt="Mineiro Barbershop"></div>
        <div>
          <h3>Mineiro Barbershop</h3>
          <div class="sub">Centro • Belo Horizonte</div>
          <div class="statrow">
            <div class="stat"><strong>1000+</strong><span>Clientes</span></div>
            <div class="stat"><strong>9 anos</strong><span>Experiência</span></div>
            <div class="stat"><strong>4.8★</strong><span>Avaliações</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Agenda -->
    <section class="panel">
      <h2>Agenda</h2>
      <div class="kv"><div class="k">Data</div>       <div id="fDate">—</div></div>
      <div class="kv"><div class="k">Horário</div>    <div id="fTime">—</div></div>
      <div class="kv"><div class="k">Profissional</div><div id="fPros">—</div></div>
      <div class="kv">
        <div class="k">Serviços</div>
        <div class="services-list" id="fServices"></div>
      </div>
      <div class="kv"><div class="k">Duração</div>    <div id="fDur">—</div></div>
    </section>

    <!-- Cobrança -->
    <section class="panel">
      <h2>Detalhes da cobrança</h2>
      <div class="bill-row"><span class="muted">Serviços</span>      <strong id="bServices">R$ 0,00</strong></div>
      <div class="bill-row"><span class="muted">Taxa de pré-agendamento (30%)</span> <strong id="bFee">R$ 0,00</strong></div>
      <div class="bill-row total"><span class="muted">Restante a pagar na barbearia (70%)</span> <strong id="bRest">R$ 0,00</strong></div>
    </section>
  </div>

  <div class="confirm-bar">
    <button class="btn-ghost ripple" id="btnBack">Voltar</button>
    <button class="btn btn-primary ripple" id="btnPay" disabled>Confirmar e pagar</button>
  </div>
</main>

<script>
  // ===== util =====
  const money = v => 'R$ ' + Number(v||0).toFixed(2).replace('.', ',');
  const getStore = k => localStorage.getItem(k) ?? sessionStorage.getItem(k);

  // ===== mapeamentos simples (exibidos na revisão) =====
  const PROS = {
    fernando: {name:'Fernando', role:'Barbeiro', avatar:'img/pro-fernando.jpg'},
    jonnier:  {name:'Jonnier',  role:'Stylist',  avatar:'img/pro-jonnier.jpg'},
    marcos:   {name:'Marcos',   role:'Barbeiro', avatar:'img/pro-marcos.jpg'},
    aline:    {name:'Aline',    role:'Colorista',avatar:'img/pro-aline.jpg'}
  };
  const SERVICES_NAMES = {
    corte:'Corte', barba:'Barba', coloracao:'Coloração', tratamento:'Tratamento', sobrancelha:'Sobrancelha'
  };

  // ===== leitura do agendamento salvo =====
  const booking = JSON.parse(getStore('booking') || 'null');

  if(!booking){
    alert('Nenhum agendamento em progresso. Voltando…');
    location.href = 'services.html';
  }

  const rate = 0.30;
  const fee  = Math.round((booking.total * rate) * 100) / 100;
  const rest = Math.max(0, Math.round((booking.total - fee) * 100) / 100);

  // ===== preenche UI =====
  document.getElementById('fDate').textContent = booking.date;
  document.getElementById('fTime').textContent = booking.time;

  // profissionais
  let prosText = 'Qualquer profissional';
  if(booking.professionals && booking.professionals.length){
    prosText = booking.professionals.map(id => PROS[id]?.name || id).join(', ');
  }
  document.getElementById('fPros').textContent = prosText;

  // serviços
  const svcWrap = document.getElementById('fServices');
  (booking.services || []).forEach(tok=>{
    const span = document.createElement('span');
    span.className = 'tag';
    span.textContent = SERVICES_NAMES[tok] || tok;
    svcWrap.appendChild(span);
  });

  // duração
  document.getElementById('fDur').textContent = `${booking.minutes} min`;

  // cobrança
  document.getElementById('bServices').textContent = money(booking.total);
  document.getElementById('bFee').textContent      = money(fee);
  document.getElementById('bRest').textContent     = money(rest);

  // botão pagar
  const btnPay  = document.getElementById('btnPay');
  btnPay.textContent = `Confirmar e pagar ${money(fee)}`;
  btnPay.disabled = false;

  document.getElementById('btnBack').addEventListener('click', ()=> history.back());

  btnPay.addEventListener('click', ()=>{
    // aqui você integraria o gateway; por enquanto só persiste o "pagamento" e finaliza
    const payload = Object.assign({}, booking, {
      depositRate: 0.30,
      depositPaid: fee,
      remaining: rest,
      status: 'prebook-paid',
      paidAt: new Date().toISOString()
    });
    localStorage.setItem('lastBooking', JSON.stringify(payload));

    alert(`Pagamento confirmado de ${money(fee)}.\n\nSeu agendamento está garantido!`);
    // redireciona para uma tela de sucesso (ou home)
    window.location.href = 'index.html';
  });

  // ===== ripple simples (usa suas variáveis) =====
  document.addEventListener('click',(e)=>{
    const btn=e.target.closest('.ripple'); if(!btn) return;
    const r=document.createElement('span'); r.className='r';
    const b=btn.getBoundingClientRect(); r.style.left=(e.clientX-b.left)+'px'; r.style.top=(e.clientY-b.top)+'px';
    btn.appendChild(r); r.addEventListener('animationend',()=>r.remove());
  }, {passive:true});
</script>
</body>
</html>

